<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--Mapperとxmlのマッピング-->
<mapper namespace="com.example.demo.repository.BulletinBoardMapper">
  <!--スレッド登録-->
  <insert id="insertThread" >
  insert into threads(
    thread_name,
    created_at,
    updated_at
  ) values (
    #{threadName},
    CURRENT_TIMESTAMP,
    CURRENT_TIMESTAMP
  )
  </insert>
  
  <!--スレッド名、メッセージ数取得-->
  <select id="selectThreadList" resultType="Thread">
  select thread_name,count(*) as message_count from messages 
  inner join threads on messages.thread_number = threads.thread_number
  group by messages.thread_number order by messages.thread_number;
  </select>

  <!-- オートインクリメントの値を取得 -->
  <select id="selectAutoIncrement" resultType="int">
  select max(thread_number) from threads;
  </select>
  
  <!-- メッセージ登録 -->
  <insert id="insertMessage">
  insert into messages(
  	thread_number,
  	message,
  	created_at,
  	created_name,
  	updated_at
  ) values (
  	#{threadNumber},
  	#{message},
  	CURRENT_TIMESTAMP,
  	#{contributorName},
  	CURRENT_TIMESTAMP
  )
  </insert>

</mapper>
